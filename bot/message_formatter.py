#!/usr/bin/env python3
"""
–ú–æ–¥—É–ª—å –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
"""

from typing import Dict, List, Any
from config.regions import ALL_LOCATIONS

class MessageFormatter:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–∏–ª–µ"""
    
    @staticmethod
    def welcome_message(is_new_user: bool = False) -> str:
        """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
        text = """üè† <b>Daft.ie Property Bot</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É–º–Ω—ã–π –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –ò—Ä–ª–∞–Ω–¥–∏–∏!"""
        
        if is_new_user:
            text += "\n\nüÜï <i>–í—ã –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å! –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã.</i>"
        
        text += """

<b>üöÄ –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç:</b>
‚Ä¢ üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
‚Ä¢ üéØ –ì–∏–±–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ (—Ä–µ–≥–∏–æ–Ω—ã, —Ü–µ–Ω–∞, —Å–ø–∞–ª—å–Ω–∏)
‚Ä¢ üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Ä¢ ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
‚Ä¢ üåç –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –ò—Ä–ª–∞–Ω–¥–∏–∏

<i>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é –Ω–∏–∂–µ ‚Üì</i>"""
        
        return text
    
    @staticmethod
    def main_menu() -> str:
        """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
        return """üè† <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>

–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ:"""
    
    @staticmethod
    def settings_menu() -> str:
        """–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
        return """‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞</b>

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:"""
    
    @staticmethod
    def regions_menu() -> str:
        """–ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞–º–∏"""
        return """üèòÔ∏è <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞–º–∏</b>

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–π–æ–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:"""
    
    @staticmethod
    def add_region_menu() -> str:
        """–ú–µ–Ω—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞"""
        return """‚ûï <b>–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥–∏–æ–Ω</b>

–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ –ø–æ–∏—Å–∫–∞:"""
    
    @staticmethod
    def current_settings(settings: Dict[str, Any]) -> str:
        """–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        regions_text = ", ".join([
            ALL_LOCATIONS.get(region, region) for region in settings.get("regions", [])
        ])
        
        interval_minutes = settings.get("monitoring_interval", 3600) // 60
        interval_text = f"{interval_minutes} –º–∏–Ω" if interval_minutes < 60 else f"{interval_minutes // 60} —á"
        
        return f"""‚öôÔ∏è <b>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</b>

üèòÔ∏è <b>–†–µ–≥–∏–æ–Ω—ã:</b> {regions_text or "–ù–µ –≤—ã–±—Ä–∞–Ω—ã"}
üõèÔ∏è <b>–ú–∏–Ω–∏–º—É–º —Å–ø–∞–ª–µ–Ω:</b> {settings.get("min_bedrooms", 0)}
üí∞ <b>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</b> ‚Ç¨{settings.get("max_price", 0):,}
‚è∞ <b>–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏:</b> {interval_text}
üìÑ <b>–ú–∞–∫—Å–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</b> {settings.get("max_results_per_search", 50)}"""
    
    @staticmethod
    def monitoring_status(is_active: bool, settings: Dict[str, Any]) -> str:
        """–°—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
        status_emoji = "üü¢" if is_active else "üî¥"
        status_text = "–ê–∫—Ç–∏–≤–µ–Ω" if is_active else "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        
        regions_text = ", ".join([
            ALL_LOCATIONS.get(region, region) for region in settings.get("regions", [])
        ])
        
        return f"""üìä <b>–°—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</b>

{status_emoji} <b>–°—Ç–∞—Ç—É—Å:</b> {status_text}

{MessageFormatter.current_settings(settings)}"""
    
    @staticmethod
    def statistics_main(user_name: str, total_properties: int) -> str:
        """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        return f"""üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞</b>

üë§ <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</b> {user_name}
üè† <b>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π (7 –¥–Ω–µ–π):</b> {total_properties}

–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:"""
    
    @staticmethod
    def help_message() -> str:
        """–°–ø—Ä–∞–≤–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
        return """‚ùì <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É</b>

<b>üéÆ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
‚Ä¢ <code>/start</code> ‚Äî –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚Ä¢ <code>/status</code> ‚Äî –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚Ä¢ <code>/help</code> ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

<b>üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:</b>
‚Ä¢ <b>–ó–∞–ø—É—Å—Ç–∏—Ç—å</b> ‚Äî –Ω–∞—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
‚Ä¢ <b>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</b> ‚Äî –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚Ä¢ <b>–†–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫</b> ‚Äî –Ω–∞–π—Ç–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

<b>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏:</b>
‚Ä¢ <b>–†–µ–≥–∏–æ–Ω—ã</b> ‚Äî –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–æ–≤ –∏ –≥–æ—Ä–æ–¥–æ–≤
‚Ä¢ <b>–°–ø–∞–ª—å–Ω–∏</b> ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç
‚Ä¢ <b>–¶–µ–Ω–∞</b> ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç
‚Ä¢ <b>–ò–Ω—Ç–µ—Ä–≤–∞–ª</b> ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

<b>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

<i>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</i>"""
    
    @staticmethod
    def property_summary(property_data: Dict[str, Any]) -> str:
        """–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"""
        price = f"‚Ç¨{property_data.get('price', 0):,}" if property_data.get('price') else "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞"
        bedrooms = f"{property_data.get('bedrooms', 'N/A')} —Å–ø–∞–ª–µ–Ω"
        location = property_data.get('location', '–õ–æ–∫–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞')
        
        return f"""üè† <b>{property_data.get('title', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</b>

üìç <b>–ê–¥—Ä–µ—Å:</b> {location}
üí∞ <b>–¶–µ–Ω–∞:</b> {price}
üõèÔ∏è <b>–°–ø–∞–ª—å–Ω–∏:</b> {bedrooms}

<a href="{property_data.get('url', '#')}">üîó –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>"""
    
    @staticmethod
    def search_results_header(total_found: int, filtered_count: int, region: str = "") -> str:
        """–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞"""
        region_text = f" –≤ —Ä–µ–≥–∏–æ–Ω–µ <b>{region}</b>" if region else ""
        
        if total_found == 0:
            return f"""üîç <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</b>{region_text}

üòî –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞."""
        
        return f"""üîç <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</b>{region_text}

‚úÖ <b>–ù–∞–π–¥–µ–Ω–æ:</b> {total_found} –æ–±—ä—è–≤–ª–µ–Ω–∏–π
üéØ <b>–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö:</b> {filtered_count} –æ–±—ä—è–≤–ª–µ–Ω–∏–π"""
    
    @staticmethod
    def error_message(error_type: str = "general") -> str:
        """–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö"""
        messages = {
            "general": "‚ùå <b>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</b>\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
            "no_settings": "‚ùå <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</b>\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.",
            "parsing_error": "‚ùå <b>–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞</b>\n\n–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            "network_error": "üåê <b>–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é</b>\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        }
        return messages.get(error_type, messages["general"])
    
    @staticmethod
    def success_message(action: str, details: str = "") -> str:
        """–°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö"""
        base_text = f"‚úÖ <b>{action}</b>"
        if details:
            base_text += f"\n\n{details}"
        return base_text
    
    @staticmethod
    def confirmation_message(action: str, details: str = "") -> str:
        """–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π"""
        base_text = f"‚ùì <b>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</b>\n\n{action}"
        if details:
            base_text += f"\n\n<i>{details}</i>"
        return base_text
